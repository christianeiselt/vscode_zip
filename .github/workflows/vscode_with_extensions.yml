name: Visual Studio Code Pipeline

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: windows-latest

    steps:
      - name: Checkout main branch
        uses: actions/checkout@v3
      - name: Print working directory
        run: pwd
      - name: List directory content
        run: dir

      # Download vscode zip
      - name: Download vscode archive
        run: ./Download-VSCodex64Archive.ps1
      - name: Move file to data directory
        run: |
          mkdir -p vscode\extensions
          mv VSCode*.zip vscode

      # - name: Download vscode install script
      #   run: Invoke-WebRequest https://raw.githubusercontent.com/PowerShell/vscode-powershell/main/scripts/Install-VSCode.ps1 -Outfile Install-VSCode.ps1

      # Download and Install VS Code and extensions on Windows
      - name: Download and install
        run: ./Install-VSCodeExtensions.ps1 -AdditionalExtensions $((Get-Content ./packages.json | ConvertFrom-Json).extensions.uid) -BuildEdition 'Stable-User'

      # - name: Save tree file for C to artifact
      #   run: powershell -command "tree /f /a c:\ > vscode/tree_C.txt"

      - name: Archive Data Directory
        uses: actions/upload-artifact@v3
        with:
          name: data-artifact
          path: vscode

      - name: Remove artifiact directory
        run: Remove-Item -recurse -force vscode

      - name: List directory tree
        run: tree /f /a

      # - name: Save tree file for D to artifact
      #   run: powershell -command "tree /f /a d:\ > vscode/tree_D.txt"

      # - name: GitHub Commit & Push
      #   uses: actions-js/push@v1.4
      #   with:
      #     github_token: ${{ secrets.GITHUB_TOKEN }}

## save name of extensions and their (and vscodes) version number in a file
## run pipeline daily
## check and mail if version was incremented
